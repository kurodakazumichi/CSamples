# 簡易TCPサーバー、クライアント

## 概要

簡単なサーバーとクライアントプログラムを実装する。

サーバーとクライアントで以下の内容を実装する。



- サーバー

  接続を待ち、接続されたら`Hello`という文字を返す

- クライアント

  サーバーに接続し、サーバーからやってきたデータをコンソールに表示する



## プロジェクトの作成

① サーバーとクライアント用にプロジェクトを2つ作成する。

- SimpleTcpServerDemo
- SimpleTcpClientDemo



② ソケットの機能を使えるようにするため`ws2_32.lib`をリンクするようにする

1. 「プロジェクトを右クリック→プロパティ→リンカー→入力」を開く
2. 追加の依存ファイルを選択すると入力欄の右側に下矢印がでるのでクリック→編集
3. 入力欄に`ws2_32.lib`と入力→OK



③`main.c`を用意する



## 動作確認

それぞれのプロジェクトをビルドするとソリューションフォルダ直下の`Debug`フォルダの中に`SimpleTcpServerDemo.exe`と`SimpleTcpClientDemo.exe`が作られるので、コマンドプロンプト(PowerShellでもOK)を２つ開き、それぞれを順番に実行する。

※実行する順番はServer→Client。



Client側のコンソールに`Hello`と表示されれば通信成功





## 用語

Windowsのソケットプログラムをしていると登場する略語について補足



### WSA

Windows Sockets APIの略



### sin

socket address, internetの略



## メモ

### WinSock2.h

Windowsでソケットプログラム(通信プログラム)を作成する場合は`WinSock2.h`を使う。



### WSADATA構造体

Windows Socketsに関する情報を格納するための構造体で、`WSAStartup`関数を実行することで値が設定される。

APIのバージョン？情報だったりシステムのステータス情報などが入っている。



### sockaddr_in 構造体

通信するうえでの決まり事などを設定する構造体。

IPv4による通信であるとか、ポート番号やアドレスなどを設定する。



### MAKEWORDマクロ

２つのBYTE(8ビット)からWORD(16ビット)のデータを作るマクロ

`MAKEWORD(2, 0)`とすると以下のように下位8ビットに2、上位8ビットに0が設定されたWORDが作られる。

| 上位8bit | 下位8bit |
| -------- | -------- |
| 00000000 | 00000010 |

